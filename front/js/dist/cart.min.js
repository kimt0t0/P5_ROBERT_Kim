"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}var productId,productColor,productQuantity,productImgUrl,cart=localStorage,cartCounter=0,totalPrice=0,Contact=function(){function c(t,e,r,n,a){_classCallCheck(this,c),this.firstName=t.value,this.lastName=e.value,this.address=r.value,this.city=n.value,this.email=a.value}return _createClass(c,[{key:"getFirstName",value:function(){return this.firstName}},{key:"getLastName",value:function(){return this.lastName}},{key:"getAddress",value:function(){return this.address}},{key:"getCity",value:function(){return this.city}},{key:"getEmail",value:function(){return this.email}}]),c}();function getProduct(o){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch("http://localhost:3000/api/products").then(function(t){return t.json()}).then(function(t){var e=!0,r=!1,n=void 0;try{for(var a,c=t[Symbol.iterator]();!(e=(a=c.next()).done);e=!0)if(product=a.value,product._id==o)return product}catch(t){r=!0,n=t}finally{try{e||null==c.return||c.return()}finally{if(r)throw n}}}).catch(function(t){alert(t)}));case 1:case"end":return t.stop()}})}function setFormAttributes(e,r,n,a,c){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:e.setAttribute("pattern",r),e.setAttribute("min-length",n),e.setAttribute("max-length",a),e.setAttribute("title",c);case 4:case"end":return t.stop()}})}function createProducts(e){var r,n,a,c;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:for(r=[],n=0;n<e.length;n++)a=localStorage.key(n),c=a.split(" "),productId=c[0],r.includes(productId)||(r[n]=productId);return t.abrupt("return",r);case 3:case"end":return t.stop()}})}function checkForm(e){var r,n,a,c,o,u,i,s,d,l,m,p;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:for(r=document.getElementById("firstName"),n=document.getElementById("lastName"),a=document.getElementById("address"),c=document.getElementById("city"),o=document.getElementById("email"),i=[r,n,a,c,o],d=!(s=[u=/^[a-zA-Z\s'-]+$/,u,/^[a-zA-Z0-9\s,'-]*$/,u,/^[A-Za-z0-9._%+-]+@([A-Za-z0-9-]+\.)+([A-Za-z0-9]{2,4})$/]),l=0;l<i.length;l++)test=s[l].test(i[l].value),0==test&&(errMessage=document.getElementById(i[l].name+"ErrorMsg"),errMessage.textContent="Ce champ est vide ou n'a pas été complété correctement.",d=!0);if(1==d)return e.preventDefault(),t.abrupt("return",alert("Votre commande n'a pas pu être finalisée.\nVeuillez vérifier que vous avez complété correctement le formulaire.\n\nEn cas de problème, n'hésitez pas à contacter notre support"));t.next=17;break;case 17:return e.preventDefault(),contact=new Contact(r,n,a,c,o),t.next=21,regeneratorRuntime.awrap(createProducts(cart));case 21:return m=t.sent,orderData={contact:contact,products:m},t.next=25,regeneratorRuntime.awrap(postOrder(orderData));case 25:p=t.sent,console.log(p);case 27:case"end":return t.stop()}})}function postOrder(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:fetch("http://localhost:3000/api/products/order",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(e)}).then(function(t){return t.json()}).then(function(t){return console.log("Num. commande: ",t.orderId),redirect("../front/html/confirmation.html/"+t.orderId)}).catch(function(t){return console.log("Erreur: ",t)});case 1:case"end":return t.stop()}})}function hydrateDom(r,n,a,c,e){var o,u,i,s,d,l,m,p,f,h,g,y,_,b;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:o=document.createElement("article"),u=document.createElement("div"),i=document.createElement("img"),s=document.createElement("div"),d=document.createElement("div"),l=document.createElement("h2"),m=document.createElement("p"),p=document.createElement("p"),f=document.createElement("div"),h=document.createElement("div"),g=document.createElement("p"),y=document.createElement("input"),_=document.createElement("div"),b=document.createElement("p"),document.getElementById("cart__items").appendChild(o),o.appendChild(u),u.appendChild(i),o.appendChild(s),s.appendChild(d),d.appendChild(l),d.appendChild(m),d.appendChild(p),s.appendChild(f),f.appendChild(h),h.appendChild(g),h.appendChild(y),f.appendChild(_),_.appendChild(b),o.setAttribute("class","cart__item"),o.setAttribute("data-id",productId),o.setAttribute("data-color",productColor),u.setAttribute("class","cart__item__img"),i.setAttribute("src",r.imageUrl),i.setAttribute("alt",r.altTxt),s.setAttribute("class","cart__item__content"),d.setAttribute("class","cart__item__content__description"),l.textContent=r.name,m.textContent=productColor,p.textContent=Number(r.price)+" €",f.setAttribute("class","cart__item__content__settings"),h.setAttribute("class","cart__item__content__settings__quantity"),g.textContent="Qté : "+c,y.setAttribute("type","number"),y.setAttribute("class","itemQuantity"),y.setAttribute("name","itemQuantity"),y.setAttribute("min","1"),y.setAttribute("max","100"),y.setAttribute("value",c),_.setAttribute("class","cart__item__content__settings__delete"),b.setAttribute("class","deleteItem"),b.textContent="Supprimer",document.getElementById("totalQuantity").textContent=n,document.getElementById("totalPrice").textContent=a,y.addEventListener("change",function(t){n-=Number(c),a-=Number(c)*Number(r.price),c=t.target.value,g.textContent="Qté : "+c,n+=Number(c),a+=Number(c)*Number(r.price),document.getElementById("totalQuantity").textContent=n,document.getElementById("totalPrice").textContent=a,cart[e]=c}),b.addEventListener("click",function(t){n-=Number(c),a-=Number(c)*Number(r.price);var e=productId+" "+productColor;cart.removeItem(e),document.getElementById("totalQuantity").textContent=n,document.getElementById("totalPrice").textContent=a,t.target.closest("article").remove()});case 55:case"end":return t.stop()}})}!function(){var e,r,n,a;regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:if(e<cart.length)return r=localStorage.key(e),n=r.split(" "),productId=n[0],productColor=n[1],productQuantity=cart.getItem(r),cartCounter+=Number(productQuantity),t.next=10,regeneratorRuntime.awrap(getProduct(productId));t.next=18;break;case 10:return a=t.sent,totalPrice+=Number(productQuantity)*Number(a.price),t.next=14,regeneratorRuntime.awrap(hydrateDom(a,cartCounter,totalPrice,productQuantity,r));case 14:t.sent;case 15:e++,t.next=1;break;case 18:document.getElementById("cart__order__form").addEventListener("submit",function(t){checkForm(t)});case 20:case"end":return t.stop()}})}();
//# sourceMappingURL=cart.min.js.map
