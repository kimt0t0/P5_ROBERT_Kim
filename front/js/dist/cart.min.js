"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var productId,productColor,productQuantity,cart=localStorage,cartCounter=0,totalPrice=0,Contact=function e(t,r,n,a,c){_classCallCheck(this,e),this.firstName=t.value,this.lastName=r.value,this.address=n.value,this.city=a.value,this.email=c.value};function getProducts(e){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}})}function getProduct(o){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("http://localhost:3000/api/products").then(function(e){return e.json()}).then(function(e){var t=!0,r=!1,n=void 0;try{for(var a,c=e[Symbol.iterator]();!(t=(a=c.next()).done);t=!0)if(product=a.value,product._id==o)return product}catch(e){r=!0,n=e}finally{try{t||null==c.return||c.return()}finally{if(r)throw n}}}).catch(function(e){return alert("Désolé, il y a eu une erreur: ",e)}));case 1:case"end":return e.stop()}})}function updateCartCounter(e){for(var t=cartCounter=0;t<e.length;t++){var r=localStorage.key(t);cartCounter+=Number(e[r])}return cartCounter}function checkForm(){var e=/^[a-zA-Z\s'-]+$/,t=[document.getElementById("firstName"),document.getElementById("lastName"),document.getElementById("address"),document.getElementById("city"),document.getElementById("email")],r=[e,e,/\d+\,{0,1}\s+\w+\s+\w+/,e,/^[A-Za-z0-9._%+-]+@([A-Za-z0-9-]+\.)+([A-Za-z0-9]{2,4})$/];for(i=0;i<t.length;i++){var n=t[i];if(0==r[i].test(n.value)){var a=!1;switch(n.name){case"firstName":case"lastName":document.getElementById(n.name+"ErrorMsg").textContent="Ce champ peut contenir des lettres majuscules et minuscules, apostrophes et tirets.";break;case"address":document.getElementById(n.name+"ErrorMsg").textContent="Ce champ doit commencer par un ou plusieurs chiffres éventuellement suivis d'une virgule, puis obligatoirement des lettres.";break;case"city":document.getElementById(n.name+"ErrorMsg").textContent="Ce champ doit contenir des lettres, et éventuellement une apostrophe et/ou un tiret.";break;case"email":document.getElementById(n.name+"ErrorMsg").textContent="Ce champ doit contenir une adresse mail valide, par exemple: Kim.robert@kanap.com"}}}return a}function createTable(t){var r,n,a,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=0;case 2:if(!(n<t.length)){e.next=14;break}if(a=localStorage.key(n),c=a.split(" "),productId=c[0],r.includes(productId))return e.abrupt("continue",11);e.next=10;break;case 10:r[n]=productId;case 11:n++,e.next=2;break;case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}})}function createData(){var t,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return contact=new Contact(firstName,lastName,address,city,email),e.next=3,regeneratorRuntime.awrap(createTable(cart));case 3:return t=e.sent,console.log("produits: ",t),r={contact:contact,products:t},console.log("Données à envoyer: ",r),e.abrupt("return",r);case 8:case"end":return e.stop()}})}function postOrder(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:fetch("http://localhost:3000/api/products/order",{method:"POST",redirect:"manual",headers:{"Content-type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){return cart.clear(),console.log("Id de commande: ",e.orderId),window.location="confirmation.html?orderId="+e.orderId}).catch(function(e){return console.log("Erreur: ",e)});case 1:case"end":return e.stop()}})}function hydrateDom(r,n,a,c,o){var t,u,i,s,d,l,m,p,g,h,f,b,y,C;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t=document.createElement("article"),u=document.createElement("div"),i=document.createElement("img"),s=document.createElement("div"),d=document.createElement("div"),l=document.createElement("h2"),m=document.createElement("p"),p=document.createElement("p"),g=document.createElement("div"),h=document.createElement("div"),f=document.createElement("p"),b=document.createElement("input"),y=document.createElement("div"),C=document.createElement("p"),document.getElementById("cart__items").appendChild(t),t.appendChild(u),u.appendChild(i),t.appendChild(s),s.appendChild(d),d.appendChild(l),d.appendChild(m),d.appendChild(p),s.appendChild(g),g.appendChild(h),h.appendChild(f),h.appendChild(b),g.appendChild(y),y.appendChild(C),t.setAttribute("class","cart__item"),t.setAttribute("data-id",productId),t.setAttribute("data-color",productColor),u.setAttribute("class","cart__item__img"),i.setAttribute("src",r.imageUrl),i.setAttribute("alt",r.altTxt),s.setAttribute("class","cart__item__content"),d.setAttribute("class","cart__item__content__description"),l.textContent=r.name,m.textContent=productColor,p.textContent=Number(r.price)+" €",g.setAttribute("class","cart__item__content__settings"),h.setAttribute("class","cart__item__content__settings__quantity"),f.textContent="Qté : "+c,b.setAttribute("type","number"),b.setAttribute("class","itemQuantity"),b.setAttribute("name","itemQuantity"),b.setAttribute("min","1"),b.setAttribute("max","100"),b.setAttribute("value",c),y.setAttribute("class","cart__item__content__settings__delete"),C.setAttribute("class","deleteItem"),C.textContent="Supprimer",document.getElementById("totalQuantity").textContent=n,document.getElementById("totalPrice").textContent=a,b.addEventListener("change",function(e){n=updateCartCounter(cart),productId=e.target.closest(".cart__item").getAttribute("data-id"),productColor=e.target.closest(".cart__item").getAttribute("data-color"),o=productId+" "+productColor;var t=Number(cart[o]);a-=t*Number(r.price),c=Number(e.target.value),a+=c*Number(r.price),cart[o]=c,n=updateCartCounter(cart),document.getElementById("totalQuantity").textContent=n,document.getElementById("totalPrice").textContent=a}),C.addEventListener("click",function(e){n-=Number(c),a-=Number(c)*Number(r.price),cart.removeItem(o),window.location.reload(),document.getElementById("totalQuantity").textContent=n,document.getElementById("totalPrice").textContent=a,localStorage.removeItem(o)});case 55:case"end":return e.stop()}})}!function(){var t,r,n,a;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=cart.length){e.next=5;break}alert("Attention: votre panier est vide, vous ne pouvez pas commander"),document.getElementById("order").setAttribute("diabled","true"),e.next=26;break;case 5:t=0;case 6:if(t<cart.length)return r=localStorage.key(t),n=r.split(" "),productId=n[0],productColor=n[1],productQuantity=cart.getItem(r),cartCounter+=Number(productQuantity),e.next=15,regeneratorRuntime.awrap(getProduct(productId));e.next=23;break;case 15:return a=e.sent,totalPrice+=Number(productQuantity)*Number(a.price),e.next=19,regeneratorRuntime.awrap(hydrateDom(a,cartCounter,totalPrice,productQuantity,r));case 19:e.sent;case 20:t++,e.next=6;break;case 23:0==cart.length&&(alert("Impossible de passer commande, votre panier est vide!"),document.getElementById("order").setAttribute("disabled","true")),document.getElementById("cart__order__form").addEventListener("submit",function(t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),0==checkForm(t))return e.abrupt("return",!1);e.next=4;break;case 4:return e.next=6,regeneratorRuntime.awrap(createData());case 6:return r=e.sent,e.next=9,regeneratorRuntime.awrap(postOrder(r));case 9:e.sent;case 10:case"end":return e.stop()}})});case 26:return e.abrupt("return",console.log("fin input"));case 27:case"end":return e.stop()}})}();
//# sourceMappingURL=cart.min.js.map
